# TensorFlow Federated Bazel configuration.
#
# See https://docs.bazel.build/versions/master/user-manual.html#config for
# details on the various configuration options.

# Build with modular op registration support by default.
build --define=framework_shared_object=true

# Bazel workaround to compile gRPC with the new 'cares' package.
build --define=grpc_no_ares=true

# Build with optimization enabled.
build --compilation_mode=opt

# Processor native optimizations (depends on build host capabilities).
build --copt=-march=native
build --host_copt=-march=native
build --copt=-O3
build --copt=-Wno-sign-compare
build --define with_default_optimizations=true

# Disable Tensorflow extensions that are not needed for Tensorflow Federated.
build --define=no_aws_support=true
build --define=no_hdfs_support=true
build --define=no_kafka_support=true
build --define=no_ignite_support=true
build --define=no_nccl_support=true

# Misc configuration
build:xla --define with_xla_support=true
build:v2 --define=tf_api_version=2
build --action_env TF_CONFIGURE_IOS="0"
build:cuda --define=using_cuda=true --define=using_cuda_nvcc=true
build:manylinux2010 --crosstool_top=@org_tensorflow//third_party/toolchains/preconfig/ubuntu16.04/gcc7_manylinux2010-nvcc-cuda10.0:toolchain
build --spawn_strategy=standalone
build --strategy=Genrule=standalone
build --action_env TF_NEED_CUDA="0"
build --config=manylinux2010
test --config=manylinux2010

